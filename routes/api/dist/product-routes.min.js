"use strict";var router=require("express").Router(),_require=require("../../models"),Product=_require.Product,Category=_require.Category,Tag=_require.Tag,ProductTag=_require.ProductTag;router.get("/",function(t,e){var r;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(Product.findAll({attributes:["id","product_name","price","stock"],include:[{model:Category,attributes:["category_name"]},{model:Tag,attributes:["tag_name"]}]}));case 3:r=t.sent,e.json(r),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0),e.status(500).json(t.t0);case 11:case"end":return t.stop()}},null,null,[[0,7]])}),router.get("/:id",function(e,r){var n;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(Product.findOne({where:{id:e.params.id},attributes:["id","product_name","price","stock"],include:[{model:Category,attributes:["category_name"]},{model:Tag,attributes:["tag_name"]}]}));case 3:if(n=t.sent){t.next=7;break}return r.status(404).json({message:"No product found with this id"}),t.abrupt("return");case 7:r.json(n),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.log(t.t0),r.status(500).json(t.t0);case 14:case"end":return t.stop()}},null,null,[[0,10]])}),router.post("/",function(r,n){Product.create(r.body).then(function(e){if(r.body.tagIds.length){var t=r.body.tagIds.map(function(t){return{product_id:e.id,tag_id:t}});return ProductTag.bulkCreate(t)}n.status(200).json(e)}).then(function(t){return n.status(200).json(t)}).catch(function(t){console.log(t),n.status(400).json(t)})}),router.put("/:id",function(u,e){Product.update(u.body,{where:{id:u.params.id}}).then(function(t){return ProductTag.findAll({where:{product_id:u.params.id}})}).then(function(t){var e=t.map(function(t){return t.tag_id}),r=u.body.tagIds.filter(function(t){return!e.includes(t)}).map(function(t){return{product_id:u.params.id,tag_id:t}}),n=t.filter(function(t){var e=t.tag_id;return!u.body.tagIds.includes(e)}).map(function(t){return t.id});return Promise.all([ProductTag.destroy({where:{id:n}}),ProductTag.bulkCreate(r)])}).then(function(t){return e.json(t)}).catch(function(t){e.status(400).json(t)})}),router.delete("/:id",function(t,e){}),module.exports=router;
//# sourceMappingURL=product-routes.min.js.map
